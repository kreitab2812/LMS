<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.TextFlow?>

<BorderPane prefHeight="768.0" prefWidth="1366.0" styleClass="root" stylesheets="@/com/lms/quanlythuvien/css/styles.css" xmlns="http://javafx.com/javafx/19" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.lms.quanlythuvien.controllers.user.UserDashboardController">
    <top>
        <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-background-color: #ffffff; -fx-padding: 8px 20px 8px 20px; -fx-border-color: #e2e8f0 transparent #e2e8f0 transparent; -fx-border-width: 0 0 1px 0; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 8, 0, 0, 2);">
            <children>
                <HBox alignment="CENTER_LEFT" spacing="5">
                    <TextFlow>
                        <Text text="UET" styleClass="logo-text-uet"/>
                        <Text text="-" styleClass="logo-text-separator"/>
                        <Text text="VNU" styleClass="logo-text-vnu"/>
                    </TextFlow>
                    <Label text="LIBRARY" styleClass="logo-text-library-main"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS" />

                <HBox alignment="CENTER_LEFT" spacing="5" style="-fx-background-color: #e9eff5; -fx-background-radius: 18px; -fx-padding: 4px 6px 4px 12px;" maxWidth="350.0"> <ComboBox fx:id="searchTypeComboBoxUser" prefWidth="85" promptText="Tất cả" style="-fx-background-color: transparent;"/>
                    <TextField fx:id="searchInputFieldUser" HBox.hgrow="ALWAYS" promptText="Tìm kiếm sách..." prefWidth="150" style="-fx-background-color: transparent; -fx-border-color: transparent;"/>
                    <Button fx:id="searchButtonUser" text="Tìm" styleClass="primary-button-small" onAction="#handleGlobalSearchUserAction"/>
                </HBox>

                <HBox alignment="CENTER_RIGHT" spacing="15.0">
                    <ImageView fx:id="userAvatarTopBar" fitHeight="36.0" fitWidth="36.0" pickOnBounds="true" preserveRatio="true" styleClass="avatar-image-topbar">
                    </ImageView>
                    <VBox alignment="CENTER_LEFT" spacing="0">
                        <Label fx:id="topBarUsernameLabel" text="Tên Người Dùng" styleClass="username-label-topbar"/>
                        <Label fx:id="topBarUserRoleLabel" text="Vai trò: User" styleClass="datetime-label-topbar"/>
                    </VBox>
                    <MenuButton fx:id="userActionsMenuButton" text="▽" styleClass="menu-button-user-actions">
                        <items>
                            <MenuItem fx:id="viewProfileMenuItem" text="Hồ sơ của tôi" onAction="#handleNavHoSoCuaToi" />
                            <MenuItem fx:id="settingsMenuItem" text="Cài đặt" onAction="#handleNavCaiDat"/>
                            <MenuItem fx:id="logoutMenuItemUser" text="Đăng xuất" onAction="#handleLogoutUserAction"/>
                        </items>
                    </MenuButton>
                </HBox>
            </children>
        </HBox>
    </top>

    <left>
        <VBox prefWidth="230.0" spacing="8.0" style="-fx-background-color: #ffffff; -fx-padding: 20px 12px 20px 12px; -fx-border-color: transparent #e2e8f0 transparent transparent; -fx-border-width: 0px 1px 0px 0px;">
            <children>
                <Button fx:id="navTrangChuButton" text="🏠  Trang chủ" styleClass="menu-button-user" onAction="#handleNavTrangChu" maxWidth="Infinity" alignment="BASELINE_LEFT"/>
                <Button fx:id="navThongBaoButton" text="🔔  Thông báo" styleClass="menu-button-user" onAction="#handleNavThongBao" maxWidth="Infinity" alignment="BASELINE_LEFT"/>
                <Button fx:id="navTuSachCuaToiButton" text="📚  Tủ sách của tôi" styleClass="menu-button-user" onAction="#handleNavTuSachCuaToi" maxWidth="Infinity" alignment="BASELINE_LEFT"/>
                <Button fx:id="navThuVienButton" text="🏛️  Thư viện" styleClass="menu-button-user" onAction="#handleNavThuVien" maxWidth="Infinity" alignment="BASELINE_LEFT"/>
                <Button fx:id="navQuyenGopButton" text="🎁  Quyên góp" styleClass="menu-button-user" onAction="#handleNavQuyenGop" maxWidth="Infinity" alignment="BASELINE_LEFT"/>
                <Button fx:id="navHoiDapButton" text="❓  Hỏi đáp" styleClass="menu-button-user" onAction="#handleNavHoiDap" maxWidth="Infinity" alignment="BASELINE_LEFT"/>
            </children>
            <VBox VBox.vgrow="ALWAYS"/> <Button fx:id="navLienHeAdminButton" text="📞 Liên hệ Admin" styleClass="menu-button-user-secondary" maxWidth="Infinity" alignment="BASELINE_LEFT" onAction="#handleNavLienHeAdmin"/>
        </VBox>
    </left>

    <center>
        <ScrollPane fx:id="mainContentScrollPaneUser" fitToWidth="true" styleClass="scroll-pane-dashboard" BorderPane.alignment="CENTER">
            <content>
                <VBox fx:id="dashboardMainContentContainer" spacing="30.0" alignment="TOP_CENTER" styleClass="dashboard-center-content">
                    <padding>
                        <Insets top="25.0" right="40.0" bottom="30.0" left="40.0" />
                    </padding>

                    <HBox fx:id="profileSection" alignment="CENTER_LEFT" spacing="20.0" styleClass="profile-card-user">
                        <padding>
                            <Insets top="20.0" right="25.0" bottom="20.0" left="25.0" />
                        </padding>
                        <ImageView fx:id="avatarImageView" fitHeight="80.0" fitWidth="80.0" pickOnBounds="true" preserveRatio="true" styleClass="avatar-image-dashboard"/>
                        <VBox spacing="5.0">
                            <Label fx:id="greetingLabel" styleClass="greeting-label-dashboard" text="Chào buổi chiều,"/>
                            <Label fx:id="userNameLabel" styleClass="username-label-dashboard-large" text="Tên Người Dùng"/>
                            <Label fx:id="userEmailLabel" styleClass="email-label-dashboard" text="email@example.com"/>
                        </VBox>
                        <Region HBox.hgrow="ALWAYS" />
                        <VBox alignment="CENTER_RIGHT">
                            <Label text="Số sách đang mượn:" styleClass="label-regular"/>
                            <Label fx:id="currentLoansCountLabel" styleClass="info-text-prominent-large"/>
                        </VBox>
                    </HBox>

                    <VBox spacing="10.0" styleClass="chart-card-user">
                        <padding>
                            <Insets top="15.0" right="20.0" bottom="20.0" left="20.0" />
                        </padding>
                        <Label text="HOẠT ĐỘNG MƯỢN SÁCH (14 NGÀY GẦN NHẤT)" styleClass="view-title-user-section"/>
                        <BarChart fx:id="loanHistoryLast14DaysChart" prefHeight="300.0" maxHeight="350.0" legendVisible="false" styleClass="custom-barchart-user" barGap="5.0" categoryGap="10.0">
                            <yAxis> <CategoryAxis side="LEFT" fx:id="dateAxis" label="Ngày"/>
                            </yAxis>
                            <xAxis> <NumberAxis side="BOTTOM" fx:id="loanCountAxis14Days" label="Số lượt mượn"/>
                            </xAxis>
                        </BarChart>
                    </VBox>

                    <VBox spacing="10.0" styleClass="chart-card-user">
                        <padding>
                            <Insets top="15.0" right="20.0" bottom="20.0" left="20.0" />
                        </padding>
                        <Label text="THỂ LOẠI SÁCH ĐƯỢC MƯỢN NHIỀU NHẤT" styleClass="view-title-user-section"/>
                        <BarChart fx:id="loanedGenresChart" prefHeight="350.0" maxHeight="400.0" legendVisible="false" styleClass="custom-barchart-user" barGap="5.0" categoryGap="10.0">
                            <yAxis> <CategoryAxis side="LEFT" fx:id="genreCategoryAxis" label="Thể loại"/>
                            </yAxis>
                            <xAxis> <NumberAxis side="BOTTOM" fx:id="genreLoanCountAxis" label="Số lượt mượn"/>
                            </xAxis>
                        </BarChart>
                    </VBox>

                    <VBox spacing="10.0" styleClass="list-card-user">
                        <padding>
                            <Insets top="15.0" right="15.0" bottom="15.0" left="15.0" />
                        </padding>
                        <Label text="SÁCH SẮP ĐẾN HẠN (TRONG 5 NGÀY TỚI)" styleClass="view-title-user-section"/>
                        <ListView fx:id="dueSoonListView" prefHeight="280.0" styleClass="due-soon-listview-user" VBox.vgrow="NEVER"/>
                    </VBox>

                    <VBox fx:id="quoteCardUser" alignment="CENTER" spacing="8.0" styleClass="home-quote-card-dashboard">
                        <padding>
                            <Insets top="20.0" right="25.0" bottom="20.0" left="25.0" />
                        </padding>
                        <Label text="Trích Dẫn Truyền Cảm Hứng" styleClass="home-quote-card-title"/>
                        <Label fx:id="quoteTextLabel" alignment="CENTER" textAlignment="CENTER" wrapText="true" styleClass="home-quote-card-text"/>
                        <Label fx:id="quoteAuthorLabel" alignment="CENTER" styleClass="home-quote-card-author"/>
                    </VBox>
                </VBox>
            </content>
        </ScrollPane>
    </center>
</BorderPane>